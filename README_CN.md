<div align="center">
<h1>DNS Flux</h1>

<p>è·¨å¹³å° DNS æŸ¥è¯¢ç›‘æ§å·¥å…·ï¼Œæ”¯æŒ Windows å’Œ Linux ç³»ç»Ÿ</p>

<p>
  <a href="https://mit-license.org/">
    <img src="https://img.shields.io/github/license/whoopscs/dnsflux?style=flat" alt="License">
  </a>
  <a href="https://github.com/whoopscs/dnsflux">
    <img src="https://img.shields.io/github/stars/whoopscs/dnsflux?style=flat" alt="Stars">
  </a>
  <a href="https://github.com/whoopscs/dnsflux">
    <img src="https://img.shields.io/github/forks/whoopscs/dnsflux?style=flat" alt="Forks">
  </a>
  <a href="https://github.com/whoopscs/dnsflux/releases">
    <img src="https://img.shields.io/github/v/release/whoopscs/dnsflux?sort=semver" alt="Release">
  </a>
</p>

<div>

ä¸­æ–‡ ï½œ [English](README.md)

</div>
</div>

---

## ğŸ“– é¡¹ç›®ä»‹ç»

DNSFlux æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„è·¨å¹³å° DNS æŸ¥è¯¢ç›‘æ§å·¥å…·ï¼Œä¸“ä¸ºç½‘ç»œå®‰å…¨åˆ†æã€åº”æ€¥å“åº”å’Œæ¶æ„åŸŸåæ£€æµ‹è€Œè®¾è®¡ã€‚é€šè¿‡å®æ—¶ç›‘æ§ DNS æŸ¥è¯¢è¯·æ±‚å¹¶è®°å½•è¯¦ç»†çš„è¿›ç¨‹ä¿¡æ¯ï¼Œå¸®åŠ©å®‰å…¨åˆ†æå¸ˆå¿«é€Ÿå®šä½æ¶æ„ç¨‹åºå’Œå¯ç–‘ç½‘ç»œæ´»åŠ¨ã€‚

### ğŸ¯ æ ¸å¿ƒä»·å€¼

- **åº”æ€¥å“åº”æ”¯æŒ**ï¼šé€šè¿‡æ¶æ„åŸŸåæ£€æµ‹å¿«é€Ÿå®šä½å—å®³ä¸»æœº
- **è¿›ç¨‹å…³è”åˆ†æ**ï¼šè®°å½• DNS æŸ¥è¯¢çš„è¿›ç¨‹ä¿¡æ¯ï¼Œè¾…åŠ©æ¶æ„ç¨‹åºå®šä½
- **å®æ—¶ç›‘æ§**ï¼šæä¾›å‘½ä»¤è¡Œå’Œ Web ç•Œé¢ä¸¤ç§ç›‘æ§æ–¹å¼
- **è·¨å¹³å°å…¼å®¹**ï¼šæ”¯æŒ Windows å’Œ Linux ä¸»æµæ“ä½œç³»ç»Ÿ

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### Windows å¹³å°
- **æŠ€æœ¯æ ˆ**ï¼šåŸºäº ETW (Event Tracing for Windows) äº‹ä»¶è¿½è¸ª
- **æ•°æ®æº**ï¼šMicrosoft-Windows-DNS-Client æä¾›ç¨‹åº
- **äº‹ä»¶ç±»å‹**ï¼šæ•è· ID ä¸º 3008 çš„å·²å®ŒæˆæŸ¥è¯¢äº‹ä»¶
- **æƒé™è¦æ±‚**ï¼šæ™®é€šç”¨æˆ·æƒé™å³å¯è¿è¡Œ

### Linux å¹³å°
- **æŠ€æœ¯æ ˆ**ï¼šåŸºäº eBPF (Extended Berkeley Packet Filter) æŠ€æœ¯
- **æ•°æ®æº**ï¼šå†…æ ¸ç½‘ç»œæ•°æ®åŒ…æ•è·å’Œè§£æ
- **ç›‘æ§ç‚¹**ï¼šudp_sendmsg å’Œ tcp_sendmsg ç³»ç»Ÿè°ƒç”¨
- **æƒé™è¦æ±‚**ï¼šéœ€è¦ root æƒé™æˆ–ç‰¹æƒæ¨¡å¼

### ç³»ç»Ÿç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å¹³å°é‡‡é›†å™¨     â”‚â”€â”€â”€â–¶â”‚    å†…å­˜å­˜å‚¨        â”‚â”€â”€â”€â–¶â”‚   Web æœåŠ¡å™¨     â”‚
â”‚ (ETW/eBPF)      â”‚    â”‚   (Ring Buffer)  â”‚    â”‚  (HTTP API)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DNS æŸ¥è¯¢      â”‚    â”‚   æ§åˆ¶å°è¾“å‡º       â”‚    â”‚   Web ç•Œé¢       â”‚
â”‚   JSON æ—¥å¿—     â”‚    â”‚   å®æ—¶æ—¥å¿—         â”‚    â”‚   å¯è§†åŒ–é¢æ¿      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ” DNS ç›‘æ§
- **å®æ—¶æ•è·**ï¼šç›‘æ§æ‰€æœ‰ DNS æŸ¥è¯¢è¯·æ±‚ï¼ˆAã€AAAAã€CNAMEã€MX ç­‰è®°å½•ç±»å‹ï¼‰
- **è¿›ç¨‹å…³è”**ï¼šè®°å½•å‘èµ·æŸ¥è¯¢çš„è¿›ç¨‹åç§°ã€è·¯å¾„å’Œ PID
- **æŸ¥è¯¢è¯¦æƒ…**ï¼šåŒ…å«æŸ¥è¯¢åŸŸåã€ç±»å‹ã€ç»“æœå’Œå“åº”æ—¶é—´
- **çŠ¶æ€è·Ÿè¸ª**ï¼šç›‘æ§æŸ¥è¯¢æˆåŠŸã€å¤±è´¥å’Œé”™è¯¯çŠ¶æ€

### ğŸ“Š æ•°æ®è¾“å‡º
- **æ§åˆ¶å°è¾“å‡º**ï¼šå®æ—¶æ˜¾ç¤ºæ ¼å¼åŒ–çš„ DNS æŸ¥è¯¢æ—¥å¿—
- **JSON å­˜å‚¨**ï¼šè‡ªåŠ¨ä¿å­˜æŸ¥è¯¢è®°å½•åˆ° JSON æ–‡ä»¶
- **Web ç•Œé¢**ï¼šæä¾›ç°ä»£åŒ–çš„å¯è§†åŒ–ç›‘æ§é¢æ¿
- **å†…å­˜ç¼“å­˜**ï¼šé«˜æ•ˆçš„ç¯å½¢ç¼“å†²åŒºå­˜å‚¨ï¼ˆé»˜è®¤ 5000 æ¡è®°å½•ï¼‰

### ğŸŒ Web ç•Œé¢
- **å®æ—¶æ•°æ®è¡¨æ ¼**ï¼šåŠ¨æ€æ˜¾ç¤º DNS æŸ¥è¯¢è®°å½•
- **æœç´¢è¿‡æ»¤**ï¼šæ”¯æŒåŸŸåã€è¿›ç¨‹åç­‰å¤šå­—æ®µæœç´¢
- **æ•°æ®ç»Ÿè®¡**ï¼šæ˜¾ç¤ºæ€»è®°å½•æ•°å’Œå®æ—¶ç»Ÿè®¡ä¿¡æ¯
- **å“åº”å¼è®¾è®¡**ï¼šé€‚é…æ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡

### âš™ï¸ é…ç½®é€‰é¡¹
- **å‘½ä»¤è¡Œå‚æ•°**ï¼šæ”¯æŒä¸°å¯Œçš„å¯åŠ¨å‚æ•°é…ç½®
- **ç¯å¢ƒå˜é‡**ï¼šæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®
- **æ—¥å¿—çº§åˆ«**ï¼šå¯è°ƒèŠ‚çš„æ—¥å¿—è¾“å‡ºçº§åˆ«ï¼ˆdebugã€infoã€warnã€errorï¼‰
- **ç½‘ç»œé…ç½®**ï¼šå¯è‡ªå®šä¹‰ Web æœåŠ¡ç›‘å¬åœ°å€å’Œç«¯å£

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç³»ç»Ÿè¦æ±‚

**Windows**
- Windows 10/11 æˆ– Windows Server 2016+
- .NET Framework 4.5+ (é€šå¸¸å·²é¢„è£…)
- æ™®é€šç”¨æˆ·æƒé™

**Linux**
- Linux å†…æ ¸ 4.4+ (æ”¯æŒ eBPF)
- Root æƒé™æˆ– sudo è®¿é—®
- ç°ä»£ Linux å‘è¡Œç‰ˆ (Ubuntu 18.04+, CentOS 7+, Debian 9+)

### å®‰è£…æ–¹å¼

#### æ–¹å¼ä¸€ï¼šä¸‹è½½é¢„ç¼–è¯‘ç‰ˆæœ¬

1. è®¿é—® [Releases é¡µé¢](https://github.com/whoopscs/dnsflux/releases)
2. ä¸‹è½½å¯¹åº”å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶
3. è§£å‹å¹¶è¿è¡Œ

#### æ–¹å¼äºŒï¼šæºç ç¼–è¯‘

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/whoopscs/dnsflux.git
cd dnsflux

# å®‰è£…ä¾èµ–
go mod download

# ç¼–è¯‘
go build -o dnsflux ./cmd/dnsflux

# æˆ–ä½¿ç”¨æ„å»ºè„šæœ¬
chmod +x scripts/build.sh
./scripts/build.sh
```

### ä½¿ç”¨æ–¹æ³•

#### åŸºç¡€ä½¿ç”¨

**Windows**
```cmd
# æ§åˆ¶å°æ¨¡å¼
dnsflux.exe

# Web ç•Œé¢æ¨¡å¼
dnsflux.exe -w
```

**Linux**
```bash
# æ§åˆ¶å°æ¨¡å¼
sudo ./dnsflux

# Web ç•Œé¢æ¨¡å¼
sudo ./dnsflux -w
```

#### é«˜çº§é…ç½®

```bash
# è‡ªå®šä¹‰ Web æœåŠ¡é…ç½®
dnsflux -w -a 0.0.0.0 -p 8080

# è®¾ç½®æ—¥å¿—çº§åˆ«
dnsflux -w -l debug

# å®Œæ•´å‚æ•°ç¤ºä¾‹
dnsflux --web --addr=0.0.0.0 --port=8080 --log-level=info
```

#### ç¯å¢ƒå˜é‡é…ç½®

```bash
export DNSFLUX_ENABLE_WEB=true
export DNSFLUX_HOST=0.0.0.0
export DNSFLUX_PORT=8080
export DNSFLUX_LOG_LEVEL=info
```

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç®€å†™ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--web` | `-w` | `false` | å¯ç”¨ Web æœåŠ¡ |
| `--addr` | `-a` | `127.0.0.1` | Web æœåŠ¡ç›‘å¬åœ°å€ |
| `--port` | `-p` | `58080` | Web æœåŠ¡ç›‘å¬ç«¯å£ |
| `--log-level` | `-l` | `info` | æ—¥å¿—çº§åˆ« (debug/info/warn/error) |
| `--help` | `-h` | - | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

## ğŸ“¸ ç•Œé¢é¢„è§ˆ

### Web ç›‘æ§ç•Œé¢
![Web Interface](./img/web.png)

### æ§åˆ¶å°è¾“å‡º
```
2024-01-15 14:30:25 [INFO] DNSFlux å¯åŠ¨ä¸­...
2024-01-15 14:30:25 [INFO] ç‰ˆæœ¬: v1.0.0
2024-01-15 14:30:25 [INFO] DNSFlux Web é¢æ¿å·²å¯åŠ¨ï¼Œè®¿é—® http://127.0.0.1:58080 æŸ¥çœ‹ Web ç•Œé¢
2024-01-15 14:30:25 [INFO] å½“å‰å¹³å°: windows/amd64
2024-01-15 14:30:25 [INFO] å¯åŠ¨ Windows ETW DNS Collector

[2024-01-15 14:30:26] chrome.exe (PID: 1234) -> example.com (A) -> 93.184.216.34
[2024-01-15 14:30:27] firefox.exe (PID: 5678) -> github.com (A) -> 140.82.112.3
```

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
dnsflux/
â”œâ”€â”€ cmd/dnsflux/           # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ collector/         # å¹³å°é‡‡é›†å™¨
â”‚   â”‚   â”œâ”€â”€ linux/        # Linux eBPF å®ç°
â”‚   â”‚   â””â”€â”€ windows/      # Windows ETW å®ç°
â”‚   â”œâ”€â”€ model/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ store/            # å­˜å‚¨å±‚
â”‚   â””â”€â”€ web/              # Web æœåŠ¡
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ flag/             # å‘½ä»¤è¡Œå‚æ•°
â”‚   â””â”€â”€ logger/           # æ—¥å¿—ç»„ä»¶
â”œâ”€â”€ scripts/              # æ„å»ºè„šæœ¬
â””â”€â”€ web/                  # å‰ç«¯èµ„æº
```

### æ„å»ºè¦æ±‚

- Go 1.19+
- Linux: éœ€è¦ eBPF æ”¯æŒçš„å†…æ ¸
- Windows: éœ€è¦ ETW æ”¯æŒ

### ä¾èµ–ç®¡ç†

ä¸»è¦ä¾èµ–åŒ…ï¼š
- `github.com/cilium/ebpf` - Linux eBPF æ”¯æŒ
- `github.com/0xrawsec/golang-etw` - Windows ETW æ”¯æŒ
- `github.com/sirupsen/logrus` - ç»“æ„åŒ–æ—¥å¿—
- `github.com/gin-gonic/gin` - Web æ¡†æ¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### å¼€å‘è§„èŒƒ

- éµå¾ª Go ä»£ç è§„èŒƒ
- æ·»åŠ é€‚å½“çš„æµ‹è¯•ç”¨ä¾‹
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- ç¡®ä¿è·¨å¹³å°å…¼å®¹æ€§

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](./LICENSE)ã€‚

## âš ï¸ å…è´£å£°æ˜

æœ¬å·¥å…·ä»…ç”¨äºæ•™è‚²ç›®çš„å’Œæˆæƒçš„å®‰å…¨æµ‹è¯•ç¯å¢ƒã€‚æœªç»æˆæƒè®¿é—®æˆ–ä½¿ç”¨ä¸å±äºæ‚¨çš„ç³»ç»Ÿå‡å±éæ³•è¡Œä¸ºã€‚ä½œè€…å¯¹ä»»ä½•æ»¥ç”¨æœ¬å·¥å…·çš„è¡Œä¸ºæ¦‚ä¸è´Ÿè´£ã€‚

## ğŸ’– æ”¯æŒé¡¹ç›®

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·è€ƒè™‘ç»™å®ƒä¸€ä¸ª â­ ï¼

æˆ–è€…åˆ†äº«ç»™æ‚¨çš„æœ‹å‹ï¼Œä»¥å¸®åŠ©å®ƒå¾—åˆ°æ”¹å–„ï¼

---

## ğŸ“Š Star History

<div align="center">

[![Star History Chart](https://api.star-history.com/svg?repos=whoopscs/dnsflux&type=Date)](https://star-history.com/#whoopscs/dnsflux&Date)

</div>
